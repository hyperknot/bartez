(this.webpackJsonpbartez=this.webpackJsonpbartez||[]).push([[0],{109:function(e,t){},190:function(e,t){},192:function(e,t){},202:function(e,t){},204:function(e,t){},231:function(e,t){},232:function(e,t){},237:function(e,t){},239:function(e,t){},246:function(e,t){},265:function(e,t){},324:function(e,t){},331:function(e,t,n){},332:function(e,t,n){"use strict";n.r(t);var r,a,c,o=n(1),s=n(2),i=n(3),u=n(4),l=n(8),p=n.n(l),b=n(78),d=n.n(b),f=n(32),j=n(6),h=n(5),O=n(0),m=n.n(O),y=n(59),g=n(19),v=n(176),k=n(58),x="http://ipfs.hyperknot.com/ipfs";r="https://mainnet.api.tez.ie",a=g.o.MAINNET,c="mainnet";var w=new k.a(r),D=new v.a({name:"Bartez"});w.setWalletProvider(D);var z,A,I,C,N,P={KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton:"Hic et Nunc (HEN)",KT1KEa8z6vWXDJrVqtMrAeDVzsvxat3kHaCE:"fx(hash)"},T=n(70),B=n(28),E=n(20),L=(n(77),n(105)),S=n(106);function W(e,t){var n="cached-".concat(e),r=localStorage.getItem(n);if(!r)return null;var a=JSON.parse(r);return t?a.timestamp?(new Date).getTime()/1e3-a.timestamp>t?(localStorage.removeItem(n),null):a.data:(localStorage.removeItem(n),null):a.data}function _(e,t){var n="cached-".concat(e),r={timestamp:(new Date).getTime()/1e3,data:t};localStorage.setItem(n,JSON.stringify(r))}function F(e,t,n){return J.apply(this,arguments)}function J(){return(J=Object(f.a)(m.a.mark((function e(t,n,r){var a,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=W(t,n))){e.next=3;break}return e.abrupt("return",a);case 3:if(!r){e.next=6;break}return e.next=6,M(r);case 6:return e.next=8,S.a.get(t);case 8:return c=e.sent,_(t,c.data),e.abrupt("return",c.data);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return q.apply(this,arguments)}function q(){return(q=Object(f.a)(m.a.mark((function e(t){var n,r,a,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(n="tezdomain-".concat(t),!(r=W(n,3600))){e.next=6;break}return e.abrupt("return",r);case 6:return a={query:"{reverseRecords(where: {address: {in: [".concat(t,"]}}) {items {domain: domain {name}}}}")},e.prev=7,e.next=10,S.a.post("https://api.tezos.domains/graphql",a);case 10:o=e.sent,c=o.data.data.reverseRecords.items[0].domain.name,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),c=null;case 17:return _(n,c),e.abrupt("return",c);case 19:case"end":return e.stop()}}),e,null,[[7,14]])})))).apply(this,arguments)}function M(e){return new Promise((function(t){return setTimeout(t,1e3*e)}))}window.flushCachedLS=function(){for(var e=0,t=Object.keys(localStorage);e<t.length;e++){var n=t[e];n.startsWith("cached-")&&localStorage.removeItem(n)}};var H,K,U,V,X,G,Q,Y,Z,$,ee,te,ne,re=(z=function(){function e(){Object(s.a)(this,e),Object(B.a)(this,"address",A,this),Object(B.a)(this,"tokens",I,this),Object(B.a)(this,"name",C,this),Object(B.a)(this,"expanded",N,this),Object(u.o)(this)}return Object(o.a)(e,[{key:"setName",value:function(e){e&&(this.name=e)}},{key:"addToken",value:function(e){this.tokens.push(e)}},{key:"nameOrAddress",get:function(){return this.name||this.address}},{key:"toggleExpanded",value:function(){this.expanded=!this.expanded}}]),e}(),A=Object(E.a)(z.prototype,"address",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=Object(E.a)(z.prototype,"tokens",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C=Object(E.a)(z.prototype,"name",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=Object(E.a)(z.prototype,"expanded",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(E.a)(z.prototype,"setName",[u.f],Object.getOwnPropertyDescriptor(z.prototype,"setName"),z.prototype),Object(E.a)(z.prototype,"addToken",[u.f],Object.getOwnPropertyDescriptor(z.prototype,"addToken"),z.prototype),Object(E.a)(z.prototype,"nameOrAddress",[u.g],Object.getOwnPropertyDescriptor(z.prototype,"nameOrAddress"),z.prototype),Object(E.a)(z.prototype,"toggleExpanded",[u.f],Object.getOwnPropertyDescriptor(z.prototype,"toggleExpanded"),z.prototype),z),ae=(H=function(){function e(){Object(s.a)(this,e),Object(B.a)(this,"contractAddress",K,this),Object(B.a)(this,"tokenId",U,this),Object(B.a)(this,"name",V,this),Object(B.a)(this,"balance",X,this),Object(B.a)(this,"imageIpfs",G,this),Object(B.a)(this,"showImage",Q,this),Object(u.o)(this)}return Object(o.a)(e,[{key:"allowImage",value:function(){this.showImage=!0}}]),e}(),K=Object(E.a)(H.prototype,"contractAddress",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=Object(E.a)(H.prototype,"tokenId",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=Object(E.a)(H.prototype,"name",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=Object(E.a)(H.prototype,"balance",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=Object(E.a)(H.prototype,"imageIpfs",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=Object(E.a)(H.prototype,"showImage",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(E.a)(H.prototype,"allowImage",[u.f],Object.getOwnPropertyDescriptor(H.prototype,"allowImage"),H.prototype),H),ce=(Y=function(){function e(){Object(s.a)(this,e),Object(B.a)(this,"address",Z,this),Object(B.a)(this,"tezDomain",$,this),Object(u.o)(this)}return Object(o.a)(e,[{key:"domainOrAddress",get:function(){return this.tezDomain||this.address}},{key:"loadAccount",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.client.getActiveAccount();case 2:if(!(t=e.sent)){e.next=12;break}return this.setAddress(t.address),e.t0=this,e.next=8,R(this.address);case 8:return e.t1=e.sent,e.t0.setDomain.call(e.t0,e.t1),e.next=12,ie.loadBalances();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sync",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.client.requestPermissions({network:{type:a}});case 3:t=e.sent,console.log("New connection:",t.address),this.address=t.address,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),alert("Error syncing"),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"unsync",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.clearActiveAccount();case 2:this.address=null,window.location.reload();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bcdAccountUrl",get:function(){return"https://api.better-call.dev/v1/account/".concat(c,"/").concat(this.address)}},{key:"setAddress",value:function(e){this.address=e}},{key:"setDomain",value:function(e){this.tezDomain=e}}]),e}(),Z=Object(E.a)(Y.prototype,"address",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=Object(E.a)(Y.prototype,"tezDomain",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(E.a)(Y.prototype,"domainOrAddress",[u.g],Object.getOwnPropertyDescriptor(Y.prototype,"domainOrAddress"),Y.prototype),Object(E.a)(Y.prototype,"setAddress",[u.f],Object.getOwnPropertyDescriptor(Y.prototype,"setAddress"),Y.prototype),Object(E.a)(Y.prototype,"setDomain",[u.f],Object.getOwnPropertyDescriptor(Y.prototype,"setDomain"),Y.prototype),Y),oe=new ce,se=(ee=function(){function e(){Object(s.a)(this,e),Object(i.a)(this,"contracts",u.p.map()),Object(B.a)(this,"loading",te,this),Object(B.a)(this,"largeWallet",ne,this),Object(u.o)(this)}return Object(o.a)(e,[{key:"totalTokens",get:function(){return Object(L.sum)(Array.from(this.contracts.values()).map((function(e){return e.tokens.length})))}},{key:"loadBalances",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setLoading(!0),e.next=4,F(oe.bcdAccountUrl+"/token_balances?size=50&offset=0&hide_empty=true",3600);case 4:return t=e.sent,this.loadFromBCD(t),e.next=8,this.fillContractNames();case 8:if(console.log("total: ".concat(t.total)),t.total<=1e4&&this.setLargeWallet(!1),!(t.total>50)){e.next=21;break}n=50;case 12:if(!(n<=t.total)){e.next=21;break}return e.next=15,F(oe.bcdAccountUrl+"/token_balances?size=50&offset=".concat(n,"&hide_empty=true"),3600,3);case 15:t=e.sent,this.loadFromBCD(t),console.log(n);case 18:n+=50,e.next=12;break;case 21:return e.next=23,this.fillContractNames();case 23:this.setLoading(!1),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),console.error(e.t0);case 29:case"end":return e.stop()}}),e,this,[[0,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadFromBCD",value:function(e){var t,n=Object(T.a)(e.balances);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!this.contracts.has(r.contract)){var a=new re;a.address=r.contract,this.setContract(r.contract,a)}var c=new ae;c.contractAddress=r.contract,c.tokenId=r.token_id,c.name=r.name,c.balance=parseInt(r.balance,10),12172===c.tokenId&&console.log(r);var o=["KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton"].includes(c.contractAddress)||!r.thumbnail_uri?"display_uri":"thumbnail_uri";r[o]&&(c.imageIpfs=r[o].slice(7)),this.contracts.get(r.contract).addToken(c)}}catch(s){n.e(s)}finally{n.f()}}},{key:"fillContractNames",value:m.a.mark((function e(){var t,n,r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(T.a)(this.contracts.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=17;break}if(!(r=n.value).name){e.next=7;break}return e.abrupt("continue",15);case 7:if(!P[r.address]){e.next=11;break}r.setName(P[r.address]),e.next=15;break;case 11:return e.next=13,F("https://api.better-call.dev/v1/contract/".concat(c,"/").concat(r.address));case 13:a=e.sent,r.setName(a.alias&&Object(L.unescape)(a.alias));case 15:e.next=3;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(1),t.e(e.t0);case 22:return e.prev=22,t.f(),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[1,19,22,25]])}))},{key:"setLoading",value:function(e){this.loading=e}},{key:"setContract",value:function(e,t){this.contracts.set(e,t)}},{key:"setLargeWallet",value:function(e){this.largeWallet=e}}]),e}(),te=Object(E.a)(ee.prototype,"loading",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ne=Object(E.a)(ee.prototype,"largeWallet",[u.p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Object(E.a)(ee.prototype,"totalTokens",[u.g],Object.getOwnPropertyDescriptor(ee.prototype,"totalTokens"),ee.prototype),Object(E.a)(ee.prototype,"loadFromBCD",[u.f],Object.getOwnPropertyDescriptor(ee.prototype,"loadFromBCD"),ee.prototype),Object(E.a)(ee.prototype,"fillContractNames",[u.j],Object.getOwnPropertyDescriptor(ee.prototype,"fillContractNames"),ee.prototype),Object(E.a)(ee.prototype,"setLoading",[u.f],Object.getOwnPropertyDescriptor(ee.prototype,"setLoading"),ee.prototype),Object(E.a)(ee.prototype,"setContract",[u.f],Object.getOwnPropertyDescriptor(ee.prototype,"setContract"),ee.prototype),Object(E.a)(ee.prototype,"setLargeWallet",[u.f],Object.getOwnPropertyDescriptor(ee.prototype,"setLargeWallet"),ee.prototype),ee),ie=new se;window.contractStore=ie;var ue,le,pe,be,de=n(10),fe=Object(y.a)(ue=function(e){Object(j.a)(n,e);var t=Object(h.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(de.jsxs)("div",{children:[Object(de.jsx)("h2",{children:"2. select"}),ie.loading&&Object(de.jsx)("p",{style:{marginBottom:30},children:"... loading ..."}),Object(de.jsxs)("p",{style:{marginBottom:30},children:["total: ",ie.totalTokens," tokens"]}),Array.from(ie.contracts.values()).map((function(e){return Object(de.jsx)(je,{contract:e},e.address)}))]})}}]),n}(p.a.Component))||ue,je=Object(y.a)(le=function(e){Object(j.a)(n,e);var t=Object(h.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props.contract;return Object(de.jsxs)("div",{style:{marginBottom:20},children:[Object(de.jsx)("p",{className:"contract-name",onClick:function(){return e.toggleExpanded()},children:e.name||e.address}),e.expanded&&Object(de.jsx)("div",{style:{marginTop:30,marginBottom:100},children:e.tokens.map((function(t){return Object(de.jsx)(he,{token:t},e.address+"-"+t.tokenId)}))})]})}}]),n}(p.a.Component))||le,he=Object(y.a)(pe=function(e){Object(j.a)(n,e);var t=Object(h.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props.token,t=!ie.largeWallet||e.showImage;return Object(de.jsxs)("div",{style:{display:"flex",marginBottom:10},children:[t&&Object(de.jsx)("div",{className:"token-image",style:{backgroundImage:e.imageIpfs?"url(".concat(x,"/").concat(e.imageIpfs,")"):null}}),!t&&Object(de.jsx)("div",{className:"token-image token-image-show",onClick:function(){return e.allowImage(!0)},children:"\u21d3"}),Object(de.jsxs)("div",{style:{marginLeft:10},children:[Object(de.jsxs)("p",{children:["name: ",e.name]}),Object(de.jsxs)("p",{children:["id: ",e.tokenId]}),Object(de.jsxs)("p",{children:["balance: ",e.balance]})]})]})}}]),n}(p.a.Component))||pe,Oe=fe,me=Object(y.a)(be=function(e){Object(j.a)(n,e);var t=Object(h.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(de.jsxs)("div",{children:[Object(de.jsx)("h2",{style:{display:"flex",justifyContent:"space-between"},children:Object(de.jsxs)(de.Fragment,{children:[!oe.address&&Object(de.jsxs)("div",{children:["1. ",Object(de.jsx)("button",{onClick:function(){return oe.sync()},children:"sync"})]}),oe.address&&Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)("div",{children:"1. sync"}),Object(de.jsx)("span",{onClick:function(){return oe.unsync()},children:"unsync"})]})]})}),!oe.address&&Object(de.jsx)("p",{children:"not logged in"}),oe.address&&Object(de.jsxs)("p",{children:["address: ",oe.domainOrAddress]})]})}}]),n}(p.a.Component))||be,ye=me,ge=function(e){Object(j.a)(n,e);var t=Object(h.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe.loadAccount();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(de.jsxs)("div",{className:"app",children:[Object(de.jsx)("h1",{children:"bartez"}),Object(de.jsx)(ye,{}),Object(de.jsx)(Oe,{})]})}}]),n}(p.a.Component),ve=ge;n(331);if(!(new(function(){return Object(o.a)((function e(){Object(s.a)(this,e),Object(i.a)(this,"x",void 0)}))}())).hasOwnProperty("x"))throw new Error("Transpiler is not configured correctly");Object(u.h)({computedRequiresReaction:!0,reactionRequiresObservable:!0,disableErrorBoundaries:!0}),d.a.render(Object(de.jsx)(p.a.StrictMode,{children:Object(de.jsx)(ve,{})}),document.getElementById("root"))}},[[332,1,2]]]);
//# sourceMappingURL=main.4af5e0de.chunk.js.map